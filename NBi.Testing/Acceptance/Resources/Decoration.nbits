<?xml version="1.0" encoding="utf-8"?>
<testSuite name="The TestSuite" xmlns="http://NBi/TestSuite">
  <settings>
    <default apply-to="setup-cleanup">
      <connectionString>Data Source=(local)\SQL2012;Initial Catalog=AdventureWorksDW2012;Integrated Security=true</connectionString>
    </default>
    <default apply-to="setup-cleanup">
      <connectionString>Data Source=(local)\SQL2012;Initial Catalog=AdventureWorksDW2012;Integrated Security=true</connectionString>
    </default>
  </settings>
  <group name="Check decorations">
    <setup>
      <tasks run-once="true">
        <table-reset  name="NewUsers"/>
        <table-reset  name="NewKeyDates"/>
      </tasks>
      <tasks>
        <table-load   name="NewUsers"
					file ="NewUsers.csv"
			  />
        <table-load   name="NewKeyDates"
					file ="NewKeyDates.csv"
				/>
      </tasks>
    </setup>
    <test name="decoration with setup and cleanup">
      <system-under-test>
        <execution>
          <query>
            select
            [FullName]
            , [Date] as BirthDate
            from
            [NewUsers]
            inner join
            [NewKeyDates] on
            [NewUsers].[UserKey] = [NewKeyDates].[UserKey]
            and [NewKeyDates].[Event] = 'Birth'
            where
            [UserKey] in (1,2)
          </query>
        </execution>
      </system-under-test>
      <assert>
        <equalTo>
          <resultSet>
            <row>
              <cell>Nikola Tesla</cell>
              <cell>1859-07-10</cell>
            </row>
            <row>
              <cell>Leonardo Da Vinci</cell>
              <cell>1456-04-15</cell>
            </row>
          </resultSet>
        </equalTo>
      </assert>
      <cleanup>
        <table-reset  name="NewKeyDates"/>
      </cleanup>
    </test>
    <test name="decoration with setup and cleanup">
      <system-under-test>
        <execution>
          <query>
            select
              count(*)
            from
              [NewUsers]
          </query>
        </execution>
      </system-under-test>
      <assert>
        <equalTo>
          <resultSet>
            <row>
              <cell>20</cell>
            </row>
          </resultSet>
        </equalTo>
      </assert>
      <cleanup>
        <table-reset  name="NewUsers"/>
      </cleanup>
    </test>
  </group>
</testSuite>